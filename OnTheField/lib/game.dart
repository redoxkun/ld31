/**
 * On The Field - Game that I did for LD31
 * Copyright (C) 2014 Albert Murciego Rico
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

library game;

import 'dart:async';
import 'dart:html';
import 'dart:math';

import 'package:krentileLD31/krentile.dart';

part 'character.dart';
part 'state.dart';

class Game {
  
  Krentile _krentile;
  
  CanvasElement _canvas;
  
  State _state;
  
  AudioElement _ambient;
  
  AudioElement _whistle;
  
  // Keys
  bool _downPressed = false;
  bool _upPressed = false;
  bool _rightPressed = false;
  bool _leftPressed = false;
  
  bool _spacePressed = false;

  static final int KEY_CODE_LEFT = 37;
  static final int KEY_CODE_UP = 38;
  static final int KEY_CODE_RIGHT = 39;
  static final int KEY_CODE_DOWN = 40;
  static final int KEY_CODE_SPACE = 32;
  
  void main(CanvasElement canvas) {
    // Initializing...
    _canvas = canvas;
    _init();
  }
  
  void _init() {
    // Initialize keyboard...
    document.onKeyDown.listen((KeyboardEvent event) {
      if (event.keyCode == KEY_CODE_LEFT) {
        _leftPressed = true;
      } else if (event.keyCode == KEY_CODE_UP) {
        _upPressed = true;
      } else if (event.keyCode == KEY_CODE_RIGHT) {
        _rightPressed = true;
      } else if (event.keyCode == KEY_CODE_DOWN) {
        _downPressed = true;
      } else if (event.keyCode == KEY_CODE_SPACE) {
        _spacePressed = true;
      }
    });
    
    document.onKeyUp.listen((KeyboardEvent event) {
      if (event.keyCode == KEY_CODE_LEFT) {
        _leftPressed = false;
      } else if (event.keyCode == KEY_CODE_UP) {
        _upPressed = false;
      } else if (event.keyCode == KEY_CODE_RIGHT) {
        _rightPressed = false;
      } else if (event.keyCode == KEY_CODE_DOWN) {
        _downPressed = false;
      } else if (event.keyCode == KEY_CODE_SPACE) {
        _spacePressed = false;
      }
    });
    
    _ambient = new AudioElement("${_getSoundBaseUrl()}ambient.wav");
    _ambient.loop = true;
    
    _whistle = new AudioElement("${_getSoundBaseUrl()}whistle.wav");
    
    String scene = '''
      {
        "version":"1.0",
        "width":960,
        "height":600,
        "camera":[480,300],
        "backgroundColor":[1.0, 0.0, 1.0],
        "tileSize":20,
        "eventMap":[[0]],
        "layers":[
          {
            "speedX":1.0,
            "speedY":1.0,
            "tilemap":[[  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1],
                       [  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1],
                       [  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  1],
                       [  3,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  4],
                       [  5,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10, 11, 10,  9,  6],
                       [  5,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  6],
                       [  5,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  9,  6]],
            "tileSize":20,
            "tileSet":"field.png",
            "objects":[31, 32,
                       39]
          },
          {
            "speedX":1.0,
            "speedY":1.0,
            "tilemap":[[  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0, 18, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 46, 47, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 19,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 42, 22, 22, 22, 22, 22, 43,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 42, 22, 22, 22, 22, 22, 43,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 42, 22, 43,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0, 42, 22, 43,  0,  0],
                       [  0,  0, 24,  0, 25,  0,  0,  0, 25, 28, 29,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 54, 55, 65, 64,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 36, 35, 24,  0,  0,  0, 24,  0, 25,  0,  0],
                       [  0,  0, 24,  0, 25,  0,  0,  0, 25,  0, 30,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 56, 57, 50, 51, 67, 66,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 37,  0, 24,  0,  0,  0, 24,  0, 25,  0,  0],
                       [  0,  0, 24,  0, 25,  0, 26, 27, 25,  0, 31,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 58, 59, 52, 53, 69, 68,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 38,  0, 24, 26, 27,  0, 24,  0, 25,  0,  0],
                       [  0,  0, 24,  0, 25,  0,  0,  0, 25,  0, 32,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 61, 60, 50, 51, 70, 71,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 39,  0, 24,  0,  0,  0, 24,  0, 25,  0,  0],
                       [  0,  0, 24,  0, 25,  0,  0,  0, 25, 34, 33,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 63, 62, 72, 73,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 40, 41, 24,  0,  0,  0, 24,  0, 25,  0,  0],
                       [  0,  0, 44, 23, 45,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0, 44, 23, 45,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 44, 23, 23, 23, 23, 23, 45,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 44, 23, 23, 23, 23, 23, 45,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 24,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 50, 51,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 25,  0,  0],
                       [  0,  0, 20, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 48, 49, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 21,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 74, 75, 76, 77,  0,  0,  0,  0, 83, 82, 81, 80,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 78,  0,  0, 79,  0,  0,  0,  0, 85,  0,  0, 84,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]],
            "tileSize":20,
            "tileSet":"field.png",
            "objects":[]
          },
          {
            "speedX":1.0,
            "speedY":1.0,
            "tilemap":[[  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  7,  8,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
                       [  0, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 14, 13, 14, 13, 14, 13, 14, 13, 14, 15, 17, 17, 16, 13, 14, 13, 14, 13, 14, 13, 14, 13, 14, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,  0]],
            "tileSize":20,
            "tileSet":"field.png",
            "objects":[ 0, 
                        1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11,
                       12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 
                       23, 24,
                       25, 26, 27, 28,
                       29, 30,
                       33, 34,
                       36, 37, 38]
          },
          {
            "speedX":1.0,
            "speedY":1.0,
            "tilemap":[[]],
            "tileSize":20,
            "tileSet":"field.png",
            "objects":[35,
                       40, 41, 42, 43, 44,
                       45, 46, 47]
          }
        ],
        "tileSets":[
          {
            "image":"characters.png",
            "width":256,
            "height":256,
            "tiles":[
                      {"left":  0, "top":  0, "right": 20, "bottom": 20, "comment":"0 goalkeeper"},

                      {"left":  0, "top": 20, "right": 20, "bottom": 40},
                      {"left":  0, "top": 40, "right": 20, "bottom": 60},

                      {"left": 20, "top":  0, "right": 40, "bottom": 20},

                      {"left": 20, "top": 20, "right": 40, "bottom": 40},
                      {"left": 20, "top": 40, "right": 40, "bottom": 60},


                      {"left": 40, "top":  0, "right": 60, "bottom": 20, "comment":"6 team 1 player 1"},

                      {"left": 40, "top": 20, "right": 60, "bottom": 40},
                      {"left": 40, "top": 40, "right": 60, "bottom": 60},

                      {"left": 60, "top":  0, "right": 80, "bottom": 20},

                      {"left": 60, "top": 20, "right": 80, "bottom": 40},
                      {"left": 60, "top": 40, "right": 80, "bottom": 60},


                      {"left": 80, "top":  0, "right":100, "bottom": 20, "comment":"12 team 1 player 2"},

                      {"left": 80, "top": 20, "right":100, "bottom": 40},
                      {"left": 80, "top": 40, "right":100, "bottom": 60},

                      {"left":100, "top":  0, "right":120, "bottom": 20},

                      {"left":100, "top": 20, "right":120, "bottom": 40},
                      {"left":100, "top": 40, "right":120, "bottom": 60},


                      {"left":120, "top":  0, "right":140, "bottom": 20, "comment":"18 team 1 player 3"},

                      {"left":120, "top": 20, "right":140, "bottom": 40},
                      {"left":120, "top": 40, "right":140, "bottom": 60},

                      {"left":140, "top":  0, "right":160, "bottom": 20},

                      {"left":140, "top": 20, "right":160, "bottom": 40},
                      {"left":140, "top": 40, "right":160, "bottom": 60},


                      {"left": 40, "top": 60, "right": 60, "bottom": 80, "comment":"24 team 2 player 1"},

                      {"left": 40, "top": 80, "right": 60, "bottom":100},
                      {"left": 40, "top":100, "right": 60, "bottom":120},

                      {"left": 60, "top": 60, "right": 80, "bottom": 80},

                      {"left": 60, "top": 80, "right": 80, "bottom":100},
                      {"left": 60, "top":100, "right": 80, "bottom":120},


                      {"left": 80, "top": 60, "right":100, "bottom": 80, "comment":"30 team 2 player 2"},

                      {"left": 80, "top": 80, "right":100, "bottom":100},
                      {"left": 80, "top":100, "right":100, "bottom":120},

                      {"left":100, "top": 60, "right":120, "bottom": 80},

                      {"left":100, "top": 80, "right":120, "bottom":100},
                      {"left":100, "top":100, "right":120, "bottom":120},


                      {"left":120, "top": 60, "right":140, "bottom": 80, "comment":"36 team 2 player 3"},

                      {"left":120, "top": 80, "right":140, "bottom":100},
                      {"left":120, "top":100, "right":140, "bottom":120},

                      {"left":140, "top": 60, "right":160, "bottom": 80},

                      {"left":140, "top": 80, "right":160, "bottom":100},
                      {"left":140, "top":100, "right":160, "bottom":120},


                      {"left":  0, "top": 60, "right": 20, "bottom": 80, "comment":"42 arbitre"},

                      {"left":  0, "top": 80, "right": 20, "bottom":100},
                      {"left":  0, "top":100, "right": 20, "bottom":120},

                      {"left": 20, "top": 60, "right": 40, "bottom": 80},

                      {"left": 20, "top": 80, "right": 40, "bottom":100},
                      {"left": 20, "top":100, "right": 40, "bottom":120},


                      {"left":  0, "top":120, "right": 20, "bottom":140, "comment":"48 linier 1"},

                      {"left":  0, "top":140, "right": 20, "bottom":160},
                      {"left":  0, "top":160, "right": 20, "bottom":180},

                      {"left": 20, "top":120, "right": 40, "bottom":140},

                      {"left": 20, "top":140, "right": 40, "bottom":160},
                      {"left": 20, "top":160, "right": 40, "bottom":180},


                      {"left": 40, "top":120, "right": 60, "bottom":140, "comment":"54 linier 2"},

                      {"left": 40, "top":140, "right": 60, "bottom":160},
                      {"left": 40, "top":160, "right": 60, "bottom":180},

                      {"left": 60, "top":120, "right": 80, "bottom":140},

                      {"left": 60, "top":140, "right": 80, "bottom":160},
                      {"left": 60, "top":160, "right": 80, "bottom":180},


                      {"left": 80, "top":120, "right":100, "bottom":140, "comment":"60 security!"},

                      {"left": 80, "top":140, "right":100, "bottom":160},
                      {"left": 80, "top":160, "right":100, "bottom":180},

                      {"left":100, "top":120, "right":120, "bottom":140},

                      {"left":100, "top":140, "right":120, "bottom":160},
                      {"left":100, "top":160, "right":120, "bottom":180},


                      {"left":120, "top":120, "right":140, "bottom":140, "comment":"66 the jumper!"},

                      {"left":120, "top":140, "right":140, "bottom":160},
                      {"left":120, "top":160, "right":140, "bottom":180},

                      {"left":140, "top":120, "right":160, "bottom":140},

                      {"left":140, "top":140, "right":160, "bottom":160},
                      {"left":140, "top":160, "right":160, "bottom":180},


                      {"left":  0, "top":180, "right": 20, "bottom":200, "comment":"72 espectadors 1 l"},
                      {"left": 20, "top":180, "right": 40, "bottom":200},

                      {"left": 40, "top":180, "right": 60, "bottom":200},
                      {"left": 60, "top":180, "right": 80, "bottom":200},

                      {"left":  0, "top":200, "right": 20, "bottom":220, "comment":"76 espectadors 2 l"},
                      {"left": 20, "top":200, "right": 40, "bottom":220},

                      {"left": 40, "top":200, "right": 60, "bottom":220},
                      {"left": 60, "top":200, "right": 80, "bottom":220},

                      {"left":  0, "top":220, "right": 20, "bottom":240, "comment":"80 espectadors hair l"},


                      {"left": 20, "top":180, "right":  0, "bottom":200, "comment":"81 espectadors 1 r"},
                      {"left": 40, "top":180, "right": 20, "bottom":200},

                      {"left": 60, "top":180, "right": 40, "bottom":200},
                      {"left": 80, "top":180, "right": 60, "bottom":200},

                      {"left": 20, "top":200, "right":  0, "bottom":220, "comment":"85 espectadors 2 r"},
                      {"left": 40, "top":200, "right": 20, "bottom":220},

                      {"left": 60, "top":200, "right": 40, "bottom":220},
                      {"left": 80, "top":200, "right": 60, "bottom":220},

                      {"left": 20, "top":220, "right":  0, "bottom":240, "comment":"89 espectadors hair r"},


                      {"left":160, "top":  0, "right":180, "bottom": 20, "comment":"90 cat"},
                      {"left":180, "top":  0, "right":200, "bottom": 20},
                      {"left":200, "top":  0, "right":220, "bottom": 20},
                      {"left":220, "top":  0, "right":240, "bottom": 20},

                      {"left":160, "top": 20, "right":180, "bottom": 40},
                      {"left":160, "top": 40, "right":180, "bottom": 60},
                      {"left":160, "top": 60, "right":180, "bottom": 80},

                      {"left":180, "top": 20, "right":200, "bottom": 40},
                      {"left":180, "top": 40, "right":200, "bottom": 60},
                      {"left":180, "top": 60, "right":200, "bottom": 80},

                      {"left":200, "top": 20, "right":220, "bottom": 40},
                      {"left":200, "top": 40, "right":220, "bottom": 60},

                      {"left":220, "top": 20, "right":240, "bottom": 40},
                      {"left":220, "top": 40, "right":240, "bottom": 60},

                      {"left":200, "top": 60, "right":220, "bottom": 80},
                      {"left":220, "top": 60, "right":240, "bottom": 80},


                      {"left":140, "top":180, "right":160, "bottom":200, "comment":"106 security jump!"},


                      {"left":160, "top":120, "right":180, "bottom":140, "comment":"107 catch team 1"},
                      {"left":180, "top":120, "right":200, "bottom":140},
                      {"left":200, "top":120, "right":220, "bottom":140},

                      {"left":160, "top": 80, "right":180, "bottom":100, "comment":"110 catch team 2"},
                      {"left":180, "top": 80, "right":200, "bottom":100},
                      {"left":200, "top": 80, "right":220, "bottom":100},

                      {"left":160, "top":160, "right":180, "bottom":180, "comment":"113 catch security"},
                      {"left":180, "top":160, "right":200, "bottom":180, "comment":"114 catch referee"},
                      {"left":200, "top":160, "right":220, "bottom":180, "comment":"115 catch goalkeeper"},

                      {"left":160, "top":140, "right":180, "bottom":160, "comment":"116 up team 1"},
                      {"left":180, "top":140, "right":200, "bottom":160},
                      {"left":200, "top":140, "right":220, "bottom":160},

                      {"left":160, "top":100, "right":180, "bottom":120, "comment":"119 up team 2"},
                      {"left":180, "top":100, "right":200, "bottom":120},
                      {"left":200, "top":100, "right":220, "bottom":120},

                      {"left":160, "top":180, "right":180, "bottom":200, "comment":"122 up security"},
                      {"left":180, "top":180, "right":200, "bottom":200, "comment":"123 up referee"},
                      {"left":200, "top":180, "right":220, "bottom":200, "comment":"124 up goalkeeper"},


                      {"left":180, "top":120, "right":160, "bottom":140, "comment":"125 catch team 1 r"},
                      {"left":200, "top":120, "right":180, "bottom":140},
                      {"left":220, "top":120, "right":200, "bottom":140},

                      {"left":180, "top": 80, "right":160, "bottom":100, "comment":"128 catch team 2 r"},
                      {"left":200, "top": 80, "right":180, "bottom":100},
                      {"left":220, "top": 80, "right":200, "bottom":100},

                      {"left":180, "top":160, "right":160, "bottom":180, "comment":"131 catch security r"},
                      {"left":200, "top":160, "right":180, "bottom":180, "comment":"132 catch referee r"},
                      {"left":220, "top":160, "right":200, "bottom":180, "comment":"133 catch goalkeeper r"},

                      {"left":180, "top":140, "right":160, "bottom":160, "comment":"134 up team 1 r"},
                      {"left":200, "top":140, "right":180, "bottom":160},
                      {"left":220, "top":140, "right":200, "bottom":160},

                      {"left":180, "top":100, "right":160, "bottom":120, "comment":"137 up team 2 r"},
                      {"left":200, "top":100, "right":180, "bottom":120},
                      {"left":220, "top":100, "right":200, "bottom":120},

                      {"left":180, "top":180, "right":160, "bottom":200, "comment":"140 up security r"},
                      {"left":200, "top":180, "right":180, "bottom":200, "comment":"141 up referee r"},
                      {"left":220, "top":180, "right":200, "bottom":200, "comment":"142 up goalkeeper r"}

                    ]
          },
          {
            "image":"labels.png",
            "width":256,
            "height":256,
            "tiles":[
                      {"left":  0, "top":  0, "right":  0, "bottom":  0, "comment": "0 blue background"},
                      {"left":  0, "top":  0, "right":210, "bottom":210, "comment": "1 title screen"},

                      {"left":  0, "top":210, "right": 20, "bottom":230, "comment": "2 caught in"},
                      {"left": 20, "top":210, "right": 40, "bottom":230},
                      {"left": 40, "top":210, "right": 60, "bottom":230},
                      {"left": 60, "top":210, "right": 80, "bottom":230}
            ]
          },
          {
            "image":"field.png",
            "width":256,
            "height":256,
            "tiles":[
                      {"left":240, "top":  0, "right":240, "bottom":  0, "comment": "0 tranparent (the real 0!)"},
                      {"left":  0, "top":  0, "right": 20, "bottom": 20, "comment": "1 stairs 1"},

                      {"left": 20, "top":  0, "right": 40, "bottom": 20, "comment": "2 graderia 1"},

                      {"left": 40, "top":  0, "right": 60, "bottom": 20, "comment": "3 stairs 2 e"},
                      {"left": 60, "top":  0, "right": 40, "bottom": 20, "comment": "4 stairs 2 d"},

                      {"left": 60, "top":  0, "right": 80, "bottom": 20, "comment": "5 graderia 2 e"},
                      {"left": 80, "top":  0, "right": 60, "bottom": 20, "comment": "6 graderia 2 d"},

                      {"left": 80, "top":  0, "right":100, "bottom": 20, "comment": "7 tanca"},
                      {"left":100, "top":  0, "right":120, "bottom": 20},

                      {"left":120, "top":  0, "right":140, "bottom": 20, "comment": "9 gespa"},
                      {"left":140, "top":  0, "right":160, "bottom": 20},
                      {"left":160, "top":  0, "right":180, "bottom": 20},


                      {"left":  0, "top": 20, "right": 20, "bottom": 40, "comment": "12 bottom"},

                      {"left": 20, "top": 20, "right": 40, "bottom": 40},
                      {"left": 40, "top": 20, "right": 60, "bottom": 40},

                      {"left": 60, "top": 20, "right": 80, "bottom": 40},
                      {"left": 80, "top": 20, "right": 60, "bottom": 40},

                      {"left": 80, "top": 20, "right":100, "bottom": 40},


                      {"left":  0, "top": 40, "right": 20, "bottom": 60, "comment": "18 corner lt"},
                      {"left": 20, "top": 40, "right":  0, "bottom": 60, "comment": "19 corner rt"},
                      {"left":  0, "top": 60, "right": 20, "bottom": 40, "comment": "20 corner lb"},
                      {"left": 20, "top": 60, "right":  0, "bottom": 40, "comment": "21 corner rb"},

                      {"left": 20, "top": 40, "right": 40, "bottom": 60, "comment": "22 top line"},
                      {"left": 20, "top": 60, "right": 40, "bottom": 40, "comment": "23 bottom line"},
                      {"left": 40, "top": 40, "right": 60, "bottom": 60, "comment": "24 left line"},
                      {"left": 60, "top": 40, "right": 40, "bottom": 60, "comment": "25 right line"},

                      {"left": 60, "top": 40, "right": 80, "bottom": 60, "comment": "26 penalty dot l"},
                      {"left": 80, "top": 40, "right": 60, "bottom": 60, "comment": "27 penalty dot r"},


                      {"left": 80, "top": 40, "right":100, "bottom": 60, "comment": "28 front area 1 l"},
                      {"left":100, "top": 40, "right":120, "bottom": 60, "comment": "29 front area 2 l"},
                      {"left":120, "top": 40, "right":140, "bottom": 60, "comment": "30 front area 3 l"},
                      {"left":140, "top": 40, "right":160, "bottom": 60, "comment": "31 front area 4 l"},
                      {"left":120, "top": 60, "right":140, "bottom": 40, "comment": "32 front area 5 l"},
                      {"left":100, "top": 60, "right":120, "bottom": 40, "comment": "33 front area 6 l"},
                      {"left": 80, "top": 60, "right":100, "bottom": 40, "comment": "34 front area 7 l"},

                      {"left":100, "top": 40, "right": 80, "bottom": 60, "comment": "35 front area 1 r"},
                      {"left":120, "top": 40, "right":100, "bottom": 60, "comment": "36 front area 2 r"},
                      {"left":140, "top": 40, "right":120, "bottom": 60, "comment": "37 front area 3 r"},
                      {"left":160, "top": 40, "right":140, "bottom": 60, "comment": "38 front area 4 r"},
                      {"left":140, "top": 60, "right":120, "bottom": 40, "comment": "39 front area 5 r"},
                      {"left":120, "top": 60, "right":100, "bottom": 40, "comment": "40 front area 6 r"},
                      {"left":100, "top": 60, "right": 80, "bottom": 40, "comment": "41 front area 7 r"},

                      {"left":160, "top": 60, "right":140, "bottom": 80, "comment": "42 area corner lt"},
                      {"left":140, "top": 60, "right":160, "bottom": 80, "comment": "43 area corner rt"},
                      {"left":160, "top": 80, "right":140, "bottom": 60, "comment": "44 area corner lb"},
                      {"left":140, "top": 80, "right":160, "bottom": 60, "comment": "45 area corner rb"},

                      {"left":160, "top": 40, "right":180, "bottom": 60, "comment": "46 center line lt"},
                      {"left":180, "top": 40, "right":160, "bottom": 60, "comment": "47 center line rt"},
                      {"left":160, "top": 60, "right":180, "bottom": 40, "comment": "48 center line lb"},
                      {"left":180, "top": 60, "right":160, "bottom": 40, "comment": "49 center line rb"},

                      {"left":180, "top": 40, "right":200, "bottom": 60, "comment": "50 center line l"},
                      {"left":200, "top": 40, "right":180, "bottom": 60, "comment": "51 center line r"},

                      {"left":  0, "top": 60, "right": 20, "bottom": 80, "comment": "52 center dot l"},
                      {"left": 20, "top": 60, "right":  0, "bottom": 80, "comment": "53 center dot r"},

                      {"left": 20, "top": 60, "right": 40, "bottom": 80, "comment": "54 center circle 1 l"},
                      {"left": 40, "top": 60, "right": 60, "bottom": 80, "comment": "55 center circle 2 l"},
                      {"left": 60, "top": 60, "right": 80, "bottom": 80, "comment": "56 center circle 3 l"},
                      {"left": 80, "top": 60, "right":100, "bottom": 80, "comment": "57 center circle 4 l"},
                      {"left":100, "top": 60, "right":120, "bottom": 80, "comment": "58 center circle 5 l"},
                      {"left":120, "top": 60, "right":140, "bottom": 80, "comment": "59 center circle 6 l"},
                      {"left": 80, "top": 80, "right":100, "bottom": 60, "comment": "60 center circle 7 l"},
                      {"left": 60, "top": 80, "right": 80, "bottom": 60, "comment": "61 center circle 8 l"},
                      {"left": 40, "top": 80, "right": 60, "bottom": 60, "comment": "62 center circle 9 l"},
                      {"left": 20, "top": 80, "right": 40, "bottom": 60, "comment": "63 center circle 10 l"},

                      {"left": 40, "top": 60, "right": 20, "bottom": 80, "comment": "64 center circle 1 r"},
                      {"left": 60, "top": 60, "right": 40, "bottom": 80, "comment": "65 center circle 2 r"},
                      {"left": 80, "top": 60, "right": 60, "bottom": 80, "comment": "66 center circle 3 r"},
                      {"left":100, "top": 60, "right": 80, "bottom": 80, "comment": "67 center circle 4 r"},
                      {"left":120, "top": 60, "right":100, "bottom": 80, "comment": "68 center circle 5 r"},
                      {"left":140, "top": 60, "right":120, "bottom": 80, "comment": "69 center circle 6 r"},
                      {"left":100, "top": 80, "right": 80, "bottom": 60, "comment": "70 center circle 7 r"},
                      {"left": 80, "top": 80, "right": 60, "bottom": 60, "comment": "71 center circle 8 r"},
                      {"left": 60, "top": 80, "right": 40, "bottom": 60, "comment": "72 center circle 9 r"},
                      {"left": 40, "top": 80, "right": 20, "bottom": 60, "comment": "73 center circle 10 r"},

                      {"left":  0, "top": 80, "right": 20, "bottom":100, "comment": "74 area tecnica l"},
                      {"left": 20, "top": 80, "right": 40, "bottom":100},
                      {"left": 40, "top": 80, "right": 60, "bottom":100},
                      {"left": 60, "top": 80, "right": 80, "bottom":100},
                      {"left":  0, "top":100, "right": 20, "bottom":120},
                      {"left": 60, "top":100, "right": 80, "bottom":120},

                      {"left": 20, "top": 80, "right":  0, "bottom":100, "comment": "80 area tecnica r"},
                      {"left": 40, "top": 80, "right": 20, "bottom":100},
                      {"left": 60, "top": 80, "right": 40, "bottom":100},
                      {"left": 80, "top": 80, "right": 60, "bottom":100},
                      {"left": 20, "top":100, "right":  0, "bottom":120},
                      {"left": 80, "top":100, "right": 60, "bottom":120},


                      {"left":180, "top":  0, "right":200, "bottom": 20, "comment": "86 corner l"},
                      {"left":200, "top":  0, "right":180, "bottom": 20, "comment": "87 corner r"},


                      {"left":200, "top":  0, "right":220, "bottom": 20, "comment": "88 porteria l"},
                      {"left":220, "top":  0, "right":240, "bottom": 20},
                      {"left":200, "top": 20, "right":220, "bottom": 40},
                      {"left":220, "top": 20, "right":240, "bottom": 40},
                      {"left":200, "top": 40, "right":220, "bottom": 60},
                      {"left":220, "top": 40, "right":240, "bottom": 60},
                      {"left":200, "top": 60, "right":220, "bottom": 80},
                      {"left":220, "top": 60, "right":240, "bottom": 80},
                      {"left":200, "top": 80, "right":220, "bottom":100},
                      {"left":220, "top": 80, "right":240, "bottom":100},
                      {"left":220, "top":100, "right":240, "bottom":120},


                      {"left":220, "top":  0, "right":200, "bottom": 20, "comment": "99 porteria r"},
                      {"left":240, "top":  0, "right":220, "bottom": 20},
                      {"left":220, "top": 20, "right":200, "bottom": 40},
                      {"left":240, "top": 20, "right":220, "bottom": 40},
                      {"left":220, "top": 40, "right":200, "bottom": 60},
                      {"left":240, "top": 40, "right":220, "bottom": 60},
                      {"left":220, "top": 60, "right":200, "bottom": 80},
                      {"left":240, "top": 60, "right":220, "bottom": 80},
                      {"left":220, "top": 80, "right":200, "bottom":100},
                      {"left":240, "top": 80, "right":220, "bottom":100},
                      {"left":240, "top":100, "right":220, "bottom":120},

                      {"left": 80, "top":140, "right":100, "bottom":160, "comment": "110 numbers"},
                      {"left":  0, "top":120, "right": 20, "bottom":140},
                      {"left": 20, "top":120, "right": 40, "bottom":140},
                      {"left": 40, "top":120, "right": 60, "bottom":140},
                      {"left": 60, "top":120, "right": 80, "bottom":140},
                      {"left": 80, "top":120, "right":100, "bottom":140},
                      {"left":  0, "top":140, "right": 20, "bottom":160},
                      {"left": 20, "top":140, "right": 40, "bottom":160},
                      {"left": 40, "top":140, "right": 60, "bottom":160},
                      {"left": 60, "top":140, "right": 80, "bottom":160},
                      {"left":  0, "top":160, "right": 20, "bottom":180},
                      {"left": 20, "top":160, "right": 40, "bottom":180},
                      {"left": 40, "top":160, "right": 60, "bottom":180}
                    ]
          }
        ],
        "objects":[
          {"type":17, "x":470, "y":290, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},

          {"type":5, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},
          {"type":6, "x":0, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":8},

          {"type":5, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":9, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},

          {"type":15, "x":20, "y":20, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},
          {"type":15, "x":920, "y":20, "visible":true, "initialState":0, "drawsToAdvanceFrame":8},

          {"type":1, "x":40, "y":80, "visible":true, "initialState":0, "drawsToAdvanceFrame":1, "comment": "25 corners"},
          {"type":1, "x":40, "y":540, "visible":true, "initialState":0, "drawsToAdvanceFrame":1},
          {"type":1, "x":900, "y":80, "visible":true, "initialState":1, "drawsToAdvanceFrame":1},
          {"type":1, "x":900, "y":540, "visible":true, "initialState":1, "drawsToAdvanceFrame":1},

          {"type":2, "x":20, "y":260, "visible":true, "initialState":0, "drawsToAdvanceFrame":1, "comment": "29 porteries"},
          {"type":2, "x":900, "y":260, "visible":true, "initialState":1, "drawsToAdvanceFrame":1},

          {"type":3, "x":20, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":10, "comment": "31 public superior"},
          {"type":3, "x":500, "y":0, "visible":true, "initialState":1, "drawsToAdvanceFrame":10},

          {"type":4, "x":0, "y":40, "visible":true, "initialState":0, "drawsToAdvanceFrame":10, "comment": "33 public lateral"},
          {"type":4, "x":940, "y":40, "visible":true, "initialState":1, "drawsToAdvanceFrame":10},

          {"type":16, "x":270, "y":90, "visible":true, "initialState":0, "drawsToAdvanceFrame":1, "comment": "35 title.."},

          {"type":12, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8, "comment":"36 arbitre"},
          {"type":13, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8, "comment":"37 linier up"},
          {"type":14, "x":0, "y":0, "visible":true, "initialState":0, "drawsToAdvanceFrame":8, "comment":"38 linier down"},

          {"type":17, "x":470, "y":290, "visible":true, "initialState":0, "drawsToAdvanceFrame":8, "comment":"39 cat outside"},

          {"type":18, "x":430, "y":465, "visible":true, "initialState":12, "drawsToAdvanceFrame":1, "comment":"40 score"},
          {"type":18, "x":450, "y":465, "visible":true, "initialState":12, "drawsToAdvanceFrame":1},
          {"type":18, "x":470, "y":465, "visible":true, "initialState":10, "drawsToAdvanceFrame":1},
          {"type":18, "x":490, "y":465, "visible":true, "initialState":12, "drawsToAdvanceFrame":1},
          {"type":18, "x":510, "y":465, "visible":true, "initialState":12, "drawsToAdvanceFrame":1},

          {"type":19, "x":855, "y":  5, "visible":false, "initialState":0, "drawsToAdvanceFrame":1, "comment":"45 score background"},
          {"type":19, "x":430, "y":-50, "visible":false, "initialState":0, "drawsToAdvanceFrame":1, "comment":"46 caught in background"},
          {"type":20, "x":450, "y":-50, "visible":false, "initialState":0, "drawsToAdvanceFrame":1, "comment":"47 caught in"}
        ],
        "objectTypes":[
          {
            "tileSet":"characters.png",
            "tilemaps":[[[66]],
                        [[67]],
                        [[68]],
                        [[69]],
                        [[70]],
                        [[71]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5]],
            "tileSize":20
          },
          {
            "comment":"1 corner flag",
            "tileSet":"field.png",
            "tilemaps":[[[86]],
                        [[87]]],
            "states":[[0],
                      [1]],
            "tileSize":20
          },
          {
            "comment":"2 porteria",
            "tileSet":"field.png",
            "tilemaps":[[[88, 89],
                         [90, 91],
                         [92, 93],
                         [94, 95],
                         [96, 97],
                         [ 0, 98]],
                        [[100, 99],
                         [102,101],
                         [104,103],
                         [106,105],
                         [108,107],
                         [109, 0]]],
            "states":[[0],
                      [1]],
            "tileSize":20
          },
          {
            "comment":"3 public superior",
            "tileSet":"characters.png",
            "tilemaps":[[[72, 75, 73, 74, 72, 75, 73, 74, 72, 75, 73, 74, 72, 75, 73, 74, 72, 75, 73, 74, 72, 75],
                         [74, 73, 75, 72, 74, 73, 75, 72, 74, 73, 75, 72, 74, 73, 75, 72, 74, 73, 75, 72, 74, 73],
                         [76, 79, 77, 78, 76, 79, 77, 78, 76, 79, 77, 78, 76, 79, 77, 78, 76, 79, 77, 78, 76, 79]],

                        [[73, 74, 72, 75, 73, 74, 72, 75, 73, 74, 72, 75, 73, 74, 72, 75, 73, 74, 72, 75, 73, 74],
                         [75, 72, 74, 73, 75, 72, 74, 73, 75, 72, 74, 73, 75, 72, 74, 73, 75, 72, 74, 73, 75, 72],
                         [77, 78, 76, 79, 77, 78, 76, 79, 77, 78, 76, 79, 77, 78, 76, 79, 77, 78, 76, 79, 77, 78]],

                        [[81, 84, 82, 83, 81, 84, 82, 83, 81, 84, 82, 83, 81, 84, 82, 83, 81, 84, 82, 83, 81, 84],
                         [83, 82, 84, 81, 83, 82, 84, 81, 83, 82, 84, 81, 83, 82, 84, 81, 83, 82, 84, 81, 83, 82],
                         [85, 88, 86, 87, 85, 88, 86, 87, 85, 88, 86, 87, 85, 88, 86, 87, 85, 88, 86, 87, 85, 88]],

                        [[82, 83, 81, 84, 82, 83, 81, 84, 82, 83, 81, 84, 82, 83, 81, 84, 82, 83, 81, 84, 82, 83],
                         [84, 81, 83, 82, 84, 81, 83, 82, 84, 81, 83, 82, 84, 81, 83, 82, 84, 81, 83, 82, 84, 81],
                         [86, 87, 85, 88, 86, 87, 85, 88, 86, 87, 85, 88, 86, 87, 85, 88, 86, 87, 85, 88, 86, 87]]],
            "states":[[0, 1],
                      [2, 3]],
            "tileSize":20
          },
          {
            "comment":"4 public lateral",
            "tileSet":"characters.png",
            "tilemaps":[[[80],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73]],

                        [[80],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72],
                         [75],
                         [73],
                         [74],
                         [72]],

                        [[89],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82]],

                        [[89],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81],
                         [84],
                         [82],
                         [83],
                         [81]]],

            "states":[[0, 1],
                     [2, 3]],
            "tileSize":20
          },
          {
            "comment":"5 goalkeeper",
            "tileSet":"characters.png",
            "tilemaps":[[[0]],
                        [[1]],
                        [[2]],
                        [[3]],
                        [[4]],
                        [[5]],

                        [[115]],
                        [[124]],

                        [[133]],
                        [[142]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"6 team 1 player 1",
            "tileSet":"characters.png",
            "tilemaps":[[[6]],
                        [[7]],
                        [[8]],
                        [[9]],
                        [[10]],
                        [[11]],

                        [[107]],
                        [[116]],

                        [[125]],
                        [[134]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"7 team 1 player 2",
            "tileSet":"characters.png",
            "tilemaps":[[[12]],
                        [[13]],
                        [[14]],
                        [[15]],
                        [[16]],
                        [[17]],

                        [[108]],
                        [[117]],

                        [[126]],
                        [[135]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"8 team 1 player 3",
            "tileSet":"characters.png",
            "tilemaps":[[[18]],
                        [[19]],
                        [[20]],
                        [[21]],
                        [[22]],
                        [[23]],

                        [[109]],
                        [[118]],

                        [[127]],
                        [[136]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"9 team 2 player 1",
            "tileSet":"characters.png",
            "tilemaps":[[[24]],
                        [[25]],
                        [[26]],
                        [[27]],
                        [[28]],
                        [[29]],

                        [[110]],
                        [[119]],

                        [[128]],
                        [[137]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"10 team 2 player 2",
            "tileSet":"characters.png",
            "tilemaps":[[[30]],
                        [[31]],
                        [[32]],
                        [[33]],
                        [[34]],
                        [[35]],

                        [[111]],
                        [[120]],

                        [[129]],
                        [[138]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"11 team 2 player 3",
            "tileSet":"characters.png",
            "tilemaps":[[[36]],
                        [[37]],
                        [[38]],
                        [[39]],
                        [[40]],
                        [[41]],

                        [[112]],
                        [[121]],

                        [[130]],
                        [[139]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"12 arbitre",
            "tileSet":"characters.png",
            "tilemaps":[[[42]],
                        [[43]],
                        [[44]],
                        [[45]],
                        [[46]],
                        [[47]],

                        [[114]],
                        [[123]],

                        [[132]],
                        [[141]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"13 linier top",
            "tileSet":"characters.png",
            "tilemaps":[[[48]],
                        [[49]],
                        [[50]],
                        [[51]],
                        [[52]],
                        [[53]],

                        [[114]],
                        [[123]],

                        [[132]],
                        [[141]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"14 linier bottom",
            "tileSet":"characters.png",
            "tilemaps":[[[54]],
                        [[55]],
                        [[56]],
                        [[57]],
                        [[58]],
                        [[59]],

                        [[114]],
                        [[123]],

                        [[132]],
                        [[141]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9]],
            "tileSize":20
          },
          {
            "comment":"15 security",
            "tileSet":"characters.png",
            "tilemaps":[[[60]],
                        [[61]],
                        [[62]],
                        [[63]],
                        [[64]],
                        [[65]],

                        [[113]],
                        [[122]],

                        [[131]],
                        [[140]],

                        [[106]]],
            "states":[[0],
                      [3],
                      [1, 2],
                      [4, 5],
                      [6],
                      [8],
                      [7],
                      [9],
                      [10]],
            "tileSize":20
          },
          {
            "comment":"16 title screen",
            "tileSet":"labels.png",
            "tilemaps":[[[1]]],
            "states":[[0]],
            "tileSize":420
          },
          {
            "comment":"17 cat",
            "tileSet":"characters.png",
            "tilemaps":[[[90]],
                        [[91]],
                        [[92]],
                        [[93]],
                        [[94]],
                        [[95]],
                        [[96]],
                        [[97]],
                        [[98]],
                        [[99]],
                        [[100]],
                        [[101]],
                        [[102]],
                        [[103]],
                        [[104]],
                        [[105]]],
            "states":[[0],
                      [1],
                      [2],
                      [3],

                      [4, 5, 6],
                      [7, 8, 9],
                      [10,11],
                      [12,13],

                      [14],
                      [15]],
            "tileSize":20
          },
          {
            "comment":"18 numbers",
            "tileSet":"field.png",
            "tilemaps":[[[110]],
                        [[111]],
                        [[112]],
                        [[113]],
                        [[114]],
                        [[115]],
                        [[116]],
                        [[117]],
                        [[118]],
                        [[119]],
                        [[120]],
                        [[121]],
                        [[122]]],
            "states":[[0],
                      [1],
                      [2],
                      [3],
                      [4],
                      [5],
                      [6],
                      [7],
                      [8],
                      [9],
                      [10],
                      [11],
                      [12]],
            "tileSize":20
          },
          {
            "comment":"19 score background",
            "tileSet":"labels.png",
            "tilemaps":[[[0, 0, 0, 0, 0]]],
            "states":[[0]],
            "tileSize":20
          },
          {
            "comment":"20 caught in label",
            "tileSet":"labels.png",
            "tilemaps":[[[2, 3, 4, 5]]],
            "states":[[0]],
            "tileSize":20
          }
        ]
      }
    ''';
    
    _state = new State();
    _state.bestTime = -1;
    
    _krentile = new Krentile(_canvas, _getImagesBaseUrl());
    
    Future future = _krentile.loadSceneFromString(scene);
    
    future.then((_) {

      _ambient.play();
      
      _initGame();
      
      _krentile.draw();
      window.animationFrame.then(_draw);
    });
    
  }
  
  void _initGame() {
    _state.time = 0;
    _state.gameState = State.TITLE;
    
    _spaceDown = false;
    
    // Initialize cat
    Cat mainPlayer = new Cat(_krentile.getObject(0),
        _krentile.getObject(39));
    mainPlayer.sceneObject.visible = false;
    mainPlayer.sceneObject.x = -50;
    mainPlayer.sceneObject.y = -50;
    mainPlayer.lastLayerObject.visible = false;
    mainPlayer.lastLayerObject.x = 470;
    mainPlayer.lastLayerObject.y = -50;
    _state.mainPlayer = mainPlayer;
    
    // Initialize catchers
    _state.catchers.clear();
    SceneObject catcherSceneObject = _krentile.getObject(23);
    catcherSceneObject.state = 1;
    catcherSceneObject.x = 80;
    catcherSceneObject.y = 61;
    Catcher catcher = new Catcher(catcherSceneObject);
    _state.catchers.add(catcher);

    catcherSceneObject = _krentile.getObject(24);
    catcherSceneObject.state = 0;
    catcherSceneObject.x = 880;
    catcherSceneObject.y = 61;
    catcher = new Catcher(catcherSceneObject);
    _state.catchers.add(catcher);
    
    // Initialize football players
    Random rnd = new Random();
    
    // Home players
    _state.homeTeam.clear();
    // Goalkeeper
    FootballPlayer goalkeeper = new FootballPlayer(_krentile.getObject(1));
    goalkeeper.sceneObject.x = 60 + rnd.nextInt(100);
    goalkeeper.sceneObject.y = 200 + rnd.nextInt(260);
    goalkeeper.sceneObject.state = 1;
    goalkeeper.playerType = rnd.nextInt(2);
    _state.homeTeam.add(goalkeeper);
    
    // Players
    for (int i = 2; i < 12; ++i) {
      FootballPlayer footballPlayer = new FootballPlayer(_krentile.getObject(i));
      footballPlayer.sceneObject.x = 80 + rnd.nextInt(800);
      footballPlayer.sceneObject.y = 120 + rnd.nextInt(420);
      footballPlayer.sceneObject.type = 6 + rnd.nextInt(3);
      footballPlayer.sceneObject.state = 1;
      footballPlayer.playerType = rnd.nextInt(2);
      //footballPlayer.playerType = 1;
      _state.homeTeam.add(footballPlayer);
    }
    
    // Away players
    _state.awayTeam.clear();
    // Goalkeeper
    goalkeeper = new FootballPlayer(_krentile.getObject(12));
    goalkeeper.sceneObject.x = 800 + rnd.nextInt(100);
    goalkeeper.sceneObject.y = 200 + rnd.nextInt(260);
    goalkeeper.sceneObject.state = 0;
    goalkeeper.playerType = rnd.nextInt(2);
    _state.awayTeam.add(goalkeeper);
    
    // Players
    for (int i = 13; i < 23; ++i) {
      FootballPlayer footballPlayer = new FootballPlayer(_krentile.getObject(i));
      footballPlayer.sceneObject.x = 80 + rnd.nextInt(800);
      footballPlayer.sceneObject.y = 120 + rnd.nextInt(420);
      footballPlayer.sceneObject.type = 9 + rnd.nextInt(3);
      footballPlayer.sceneObject.state = 0;
      footballPlayer.playerType = rnd.nextInt(2);
      //footballPlayer.playerType = 1;
      _state.awayTeam.add(footballPlayer);
    }
    
    // Referee (same as football players)
    FootballPlayer referee = new FootballPlayer(_krentile.getObject(36));
    referee.sceneObject.x = 80 + rnd.nextInt(800);
    referee.sceneObject.y = 120 + rnd.nextInt(420);
    referee.sceneObject.state = 0;
    referee.playerType = rnd.nextInt(2);
    _state.referee = referee;
    
    // Assitants
    AssitantReferee topAssitant = new AssitantReferee(_krentile.getObject(37));
    topAssitant.sceneObject.x = 40 + rnd.nextInt(420);
    topAssitant.sceneObject.y = 75;
    _state.topAssistantReferee = topAssitant;

    AssitantReferee bottomAssitant = new AssitantReferee(_krentile.getObject(38));
    bottomAssitant.sceneObject.x = 480 + rnd.nextInt(420);
    bottomAssitant.sceneObject.y = 545;
    _state.bottomAssistantReferee = bottomAssitant;
    
    // Init title screen
    _initTitleScreen();
  }
  
  void _initTitleScreen() {
    
    _krentile.getObject(35).visible = true; // title

    _krentile.getObject(45).visible = false; // time background

    _krentile.getObject(40).x = 430;
    _krentile.getObject(40).y = 465;
    _krentile.getObject(41).x = 450;
    _krentile.getObject(41).y = 465;
    _krentile.getObject(42).x = 470;
    _krentile.getObject(42).y = 465;
    _krentile.getObject(43).x = 490;
    _krentile.getObject(43).y = 465;
    _krentile.getObject(44).x = 510;
    _krentile.getObject(44).y = 465;
    
    if (_state.bestTime > -1) {
      _drawTime(_state.bestTime);
    } else {
      _krentile.getObject(40).state = 12;
      _krentile.getObject(41).state = 12;
      _krentile.getObject(43).state = 12;
      _krentile.getObject(44).state = 12;
    }
  }
  
  void _drawTime(int time) {
    time = time ~/ 1000;
    
    int seconds = time % 60;
    _krentile.getObject(44).state = seconds % 10;
    _krentile.getObject(43).state = seconds ~/ 10;
    
    int minutes = time ~/ 60;
    if (minutes >= 100) {
      _krentile.getObject(40).state = 9;
      _krentile.getObject(41).state = 9;
      _krentile.getObject(43).state = 5;
      _krentile.getObject(44).state = 9;
    } else {
      _krentile.getObject(41).state = minutes % 10;
      _krentile.getObject(40).state = minutes ~/ 10;
    }
  }
  
  void _draw(double time) {
    
    if (_state.gameState == State.TITLE) {
      _processInTitle();
    } else if (_state.gameState == State.START_ANIMATION) {
      _processStartAnimation();
    } else if (_state.gameState == State.GAME) {
      _processInGame();
    } else if (_state.gameState == State.FINISHED) {
      _processInFinished();
    }
    
    _krentile.draw();
    window.animationFrame.then(_draw);
  }
  
  bool _spaceDown;
  
  void _processInTitle() {
    
    if (_spacePressed) {
      _spaceDown = true;
    }
    
    if (_spaceDown && !_spacePressed) {
      _spaceDown = false;
      
      _state.gameState = State.START_ANIMATION;
      
      SceneObject title = _krentile.getObject(35);
      title.visible = false;
      
      // Show time in the top right corner
      _krentile.getObject(40).x = 855;
      _krentile.getObject(40).y = 5;
      _krentile.getObject(41).x = 875;
      _krentile.getObject(41).y = 5;
      _krentile.getObject(42).x = 895;
      _krentile.getObject(42).y = 5;
      _krentile.getObject(43).x = 915;
      _krentile.getObject(43).y = 5;
      _krentile.getObject(44).x = 935;
      _krentile.getObject(44).y = 5;

      _krentile.getObject(45).visible = true;
      _krentile.getObject(45).x = 855;
      _krentile.getObject(45).y = 5;

      _drawTime(_state.time);
    }

    // Move football players
    _movePlayersAndReferees();
    
  }
  
  void _processStartAnimation() {
    
    // Move football players
    _movePlayersAndReferees();
    
    if (_state.mainPlayer.sceneObject.y == 61) {
      
      _state.mainPlayer.notMoving();
      _state.gameState = State.GAME;
      _state.time = new DateTime.now().millisecondsSinceEpoch;
      
      _state.timeLastAgressivePlayerAdded = _state.time;
      
      _whistle.currentTime = 0;
      _whistle.play();
      
      return;
    }
    
    if (_state.mainPlayer.lastLayerObject.y == -50) {
      _state.mainPlayer.sceneObject.visible = false;
      _state.mainPlayer.lastLayerObject.visible = true;
      _state.mainPlayer.lastLayerObject.state = 6;
      
    }
    
    if (_state.mainPlayer.lastLayerObject.y < 55 &&
        _state.mainPlayer.lastLayerObject.state == 6 &&
        _state.mainPlayer.lastLayerObject.visible) {
      _state.mainPlayer.lastLayerObject.y++;
      return;
    } else if (_state.mainPlayer.lastLayerObject.state != 2) {
      _state.mainPlayer.lastLayerObject.state = 2;
    }
    
    if (_state.mainPlayer.lastLayerObject.y > 40 && 
        _state.mainPlayer.lastLayerObject.state == 2 &&
        _state.mainPlayer.lastLayerObject.visible) {
      _state.mainPlayer.lastLayerObject.y--;
      return;
    } else if (!_state.mainPlayer.sceneObject.visible) {
      _state.mainPlayer.lastLayerObject.visible = false;
      _state.mainPlayer.sceneObject.visible = true;
      _state.mainPlayer.sceneObject.state = 2;
      _state.mainPlayer.sceneObject.x = _state.mainPlayer.lastLayerObject.x;
      _state.mainPlayer.sceneObject.y = _state.mainPlayer.lastLayerObject.y;
    }
    
    _state.mainPlayer.sceneObject.y++;
  }
  
  void _processInGame() {
    
    if (_state.mainPlayer.sceneObject.state == 8 ||
        _state.mainPlayer.sceneObject.state == 9) {
      
      _state.time = new DateTime.now().millisecondsSinceEpoch - _state.time;
      
      if (_state.time > _state.bestTime) {
        _state.bestTime = _state.time;
      }

      // Put on the top
      _krentile.getObject(40).x = 430;
      _krentile.getObject(40).y = -30;
      _krentile.getObject(41).x = 450;
      _krentile.getObject(41).y = -30;
      _krentile.getObject(42).x = 470;
      _krentile.getObject(42).y = -30;
      _krentile.getObject(43).x = 490;
      _krentile.getObject(43).y = -30;
      _krentile.getObject(44).x = 510;
      _krentile.getObject(44).y = -30;

      _krentile.getObject(45).visible = true;
      _krentile.getObject(45).x = 430;
      _krentile.getObject(45).y = -30;


      _krentile.getObject(46).visible = true;
      _krentile.getObject(46).x = 430;
      _krentile.getObject(46).y = -50;

      _krentile.getObject(47).visible = true;
      _krentile.getObject(47).x = 445;
      _krentile.getObject(47).y = -50;
      
      _timeSkipFinish = new DateTime.now().millisecondsSinceEpoch;
      
      _state.gameState = State.FINISHED;
      
      return;
    }
    
    _drawTime(new DateTime.now().millisecondsSinceEpoch - _state.time);
    
    if (new DateTime.now().millisecondsSinceEpoch - _state.timeLastAgressivePlayerAdded > 20000) {
      
      Random rnd = new Random();
      
      _state.homeTeam[rnd.nextInt(11)].playerType = FootballPlayer.AGGRESSIVE;
      _state.awayTeam[rnd.nextInt(11)].playerType = FootballPlayer.AGGRESSIVE;
      
      Catcher catcher = _state.catchers[rnd.nextInt(2)];
      if (catcher.movement < 0.9) {
        if (catcher.movement < 0.65 || (rnd.nextInt(10) > 3)) {
          catcher.movement = catcher.movement + (rnd.nextDouble() * 0.1);
          if (catcher.movement > 0.9) {
            catcher.movement = 0.9;
          }
        } else {
          catcher.movement = catcher.movement - (rnd.nextDouble() * 0.1);
        }
      }
      
      _state.timeLastAgressivePlayerAdded = new DateTime.now().millisecondsSinceEpoch;
    }
    
    // Move player
    if (_leftPressed && _upPressed) {
      _state.mainPlayer.moveUpLeft();
    } else if (_rightPressed && _upPressed) {
      _state.mainPlayer.moveUpRight();
    } else if (_leftPressed && _downPressed) {
      _state.mainPlayer.moveDownLeft();
    } else if (_rightPressed && _downPressed) {
      _state.mainPlayer.moveDownRight();
    } else if (_leftPressed) {
      _state.mainPlayer.moveLeft();
    } else if (_rightPressed) {
      _state.mainPlayer.moveRight();
    } else if (_upPressed) {
      _state.mainPlayer.moveUp();
    } else if (_downPressed) {
      _state.mainPlayer.moveDown();
    } else if (!_upPressed && !_leftPressed && !_downPressed && !_rightPressed) {
      _state.mainPlayer.notMoving();
    }
    
    // Move catchers
    for (Catcher catcher in _state.catchers) {
      catcher.move(_state.mainPlayer);
    }
    
    // Move football players
    _movePlayersAndReferees();
  }
  
  int _timeSkipFinish;
  
  void _processInFinished() {
    
    if (_spacePressed) {
      _spaceDown = true;
    }
    
    // Go to title screen pressing space or after 30 seconds.
    if ((_spaceDown && !_spacePressed) ||
        (new DateTime.now().millisecondsSinceEpoch - _timeSkipFinish > 30000)) {
      _spaceDown = false;
      
      _krentile.getObject(46).visible = false;
      _krentile.getObject(47).visible = false;
      
      _state.gameState = State.TITLE;
      _initGame();
      
      return;
    }

    if (_krentile.getObject(40).y < 260) {
      _krentile.getObject(40).y = _krentile.getObject(40).y + 8;
      _krentile.getObject(41).y = _krentile.getObject(41).y + 8;
      _krentile.getObject(42).y = _krentile.getObject(42).y + 8;
      _krentile.getObject(43).y = _krentile.getObject(43).y + 8;
      _krentile.getObject(44).y = _krentile.getObject(44).y + 8;
  
      _krentile.getObject(45).y = _krentile.getObject(45).y + 8;
  
      _krentile.getObject(46).y = _krentile.getObject(46).y + 8;
  
      _krentile.getObject(47).y = _krentile.getObject(47).y + 8;
    }
    
  }
  
  void _movePlayersAndReferees() {
    for (FootballPlayer footballPlayer in _state.homeTeam) {
      footballPlayer.move(_state.mainPlayer);
    }
    for (FootballPlayer footballPlayer in _state.awayTeam) {
      footballPlayer.move(_state.mainPlayer);
    }
    
    _state.referee.move(_state.mainPlayer);
    
    _state.topAssistantReferee.move(_state.mainPlayer);
    _state.bottomAssistantReferee.move(_state.mainPlayer);
  }
  
  static String _getImagesBaseUrl() {
    return "${_getBaseUrl()}images/";
  }
  
  static String _getSoundBaseUrl() {
    return "${_getBaseUrl()}sound/";
  }
  
  static String _getBaseUrl() {
    var location = window.location.href;
    
    String baseUrl;
    
    if (location.endsWith("html")) {
      baseUrl = "${location.substring(0, location.length - "index.html".length)}";
    } else if (location.endsWith("/")) {
      baseUrl = "${location}";
    } else {
      baseUrl = "${location}/";
    }
    
    return baseUrl;
  }
  
}
